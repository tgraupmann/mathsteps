<html>

<head>
    <title>Algebra Examples for Mathsteps</title>
    <script src="dist/mathsteps.js"></script>
</head>

<body>
    <div id="example1"></div>
</body>

<script>

    function doUnitTests() {
        function assertAreEqual(formula, actual, expected) {
            if ((actual == null && expected == null) ||
                actual.toString() === expected.toString()) {
                console.log(`Test [PASSED]`, `formula`, formula, `actual`, actual, `===`, `expected`, expected);
            } else {
                console.error('Test [FAILED]', `formula`, formula);
                console.error(" Test Actual: ", actual);
                console.error(" Test Expected: ", expected);
            }
            //debugger;
        };

        function testMathsteps(formula, expected) {
            const steps = mathsteps.simplifyExpression(formula);
            if (steps.length == 0) {
                assertAreEqual(formula, null, null);
            } else {
                assertAreEqual(formula, mathsteps.printNode.ascii(steps[steps.length - 1].newNode), expected);
            }
        }

        testMathsteps(`(77^2 - 127 * 77 + 3850)/ (77 - 77)`, `"DNE"`);
        testMathsteps(`1 / (77 - 77)`, `"DNE"`);
        testMathsteps(`(sqrt{2 * 0 + 64} - 8) \over 0`, `"DNE"`);
        testMathsteps(`(sqrt{2 * 0 + 64} - 8) / 0`, `"DNE"`);
        testMathsteps(`1\over 0`, `"DNE"`);
        testMathsteps(`1 / 0`, `"DNE"`);
        testMathsteps(`8 * sin(\pi+0.1) + 10`, `9.2013`);
        testMathsteps(`8 * sin(\pi) + 10`, `10`);
        testMathsteps(`sin(\pi)`, `1.2246467991473532e-16`);
        testMathsteps(`sin(2 * \pi)`, `0.00001469282041289069`);
        testMathsteps(`sin(3)`, `0.1411200080598672`);
        testMathsteps(`sin(\pi + 1)`, `-0.8414749540675642`);
        testMathsteps(`-0.00004 * 2003^2 + 0.62476 * 2003`, `1090.9139`);
        testMathsteps(`-0.00004 * 2005^2 + 0.62476 * 2005`, `1091.8428`);
        testMathsteps(`10*\sqrt{25}+20`, `70`);
        testMathsteps(`10*\sqrt{x}+20`, null);
        testMathsteps(`\sqrt{100}`, `10`);
        testMathsteps(`10*\sqrt(25)+20`, `70`);
        testMathsteps(`10*\sqrt(x)+20`, null);
        testMathsteps(`\sqrt(100)`, `10`);
        testMathsteps(`25 - 4 * 2 + 3`, `20`);
        testMathsteps(`8 * cos(\pi+0.1) + 10`, `2.04`);
        testMathsteps(`8 * cos(\pi) + 10`, `2`);
        testMathsteps(`cos(\pi)`, `-1`);
        testMathsteps(`cos(2 * \pi)`, `0.9999999998920606`);
        testMathsteps(`cos(3)`, `-0.9899924966004454`);
        testMathsteps(`cos(\pi + 1)`, `-0.5402961240625279`);
        testMathsteps(`(((x^4)^0.25)^2)^0.5`, `x`);
        testMathsteps(`(x^2)^0.5`, `x`);
        testMathsteps(`(x^0.5)^2`, `x`);
        testMathsteps(`(a + 2)*(a + 3)`, `a^2 + 5a + 6`);
        testMathsteps(`2 * a * b^2 + 3 * b^2 * a`, `5a * b^2`);
        testMathsteps(`2 * a^2 * b + 3 * b * a^2`, `5a^2 * b`);
        testMathsteps(`(a + 2)*(b - 3)`, `a * b - 3a + 2b - 6`);
        testMathsteps(`3(a + h)^2 + 2(a + h) - 1`, `3a^2 + 6a * h + 3h^2 + 2a + 2h - 1`);
        testMathsteps(`3 * a ^ 2 + 3 * a * h + 3 * a * h + 3 * h ^ 2 + 2 * a + 2 * h - 1`, `3a^2 + 6a * h + 3h^2 + 2a + 2h - 1`);
        testMathsteps(`3 * a ^ 2 + 3 * a * h + 3 * h * a + 3 * h ^ 2 + 2 * a + 2 * h - 1`, `3a^2 + 6a * h + 3h^2 + 2a + 2h - 1`);
        testMathsteps(`2 * a * b + 4 * a * b`, `6a * b`);
        testMathsteps(`2*b*a + 4*a*b`, `6 * a * b`);
        testMathsteps(`2*a + 3*a`, `5a`);
        testMathsteps(`2 * a * b + 3 * a * b`, `5a * b`);
        testMathsteps(`2 * a * b + 3 * b * a`, `5a * b`);
    }

    function doExample1() {

        const example1 = document.getElementById('example1');

        //TODO: FIX
        //WORKS:
        const formula = `(77^2 - 127 * 77 + 3850)/ (77 - 77)`;
        //const formula = `1 / (77 - 77)`;
        //const formula = `(sqrt{2 * 0 + 64} - 8) \over 0`;
        //const formula = `(sqrt{2 * 0 + 64} - 8) / 0`;
        //const formula = `1\over 0`;
        //const formula = `1 / 0`;
        //const formula = `(\sqrt{2 * 0.1 + 64} - 8) / 0.1`;
        //const formula = `(\sqrt{2 * x + 64} - 8) \over x`;
        //const formula = `(\sqrt{2 * 0.001 + 64} - 8) \over 0.001`;
        //const formula = '8 * sin(\pi+0.1) + 10';
        //const formula = '8 * sin(\pi) + 10';
        //const formula = `sin(\pi)`;
        //const formula = `sin(2 * \pi)`;
        //const formula = `sin(3)`;
        //const formula = `sin(\pi + 1)`;
        //const formula = `-0.00004 * 2003^2 + 0.62476 * 2003`;
        //const formula = `-0.00004 * 2005^2 + 0.62476 * 2005`;
        //const formula = '10 * \sqrt{25} + 20';
        //const formula = '10 * \sqrt(25) + 20';
        //const formula = '10*\sqrt(x)+20';
        //const formula = '\sqrt(100)';
        //const formula = '10 * 100^0.5 + 20';
        //const formula = '10 * 25^0.5 + 20';
        //const formula = '25 - 4 * 2 + 3';
        //const formula = '8 * cos(\pi+0.1) + 10';
        //const formula = '8 * cos(\pi) + 10'; // should be 2
        //const formula = `cos(\pi)`;
        //const formula = `cos(2 * \pi)`;
        //const formula = `cos(3)`;
        //const formula = `cos(\pi + 1)`;
        //const formula = `(((x^4)^0.25)^2)^0.5`; // should result as 2
        //const formula = `(x^2)^0.5`; // should result as 2
        //const formula = `(x^0.5)^2`; // should result as 2
        //const formula = `(a + 2)*(a + 3)`; // should result as a ^ 2 + 5 * a + 6
        //const formula = `2 * a * b^2 + 3 * b^2 * a`; // should result as 5 * a * b ^ 2
        //const formula = `2 * a^2 * b + 3 * b * a^2`; // should result as 5 * a ^ 2 * b
        //const formula = `(a + 2)*(b - 3)`; // should result as a * b - 3 * a + 2 * b - 6
        //const formula = `3(a + h)^2 + 2(a + h) - 1`; // should result to 3 * a ^ 2 + 6 * a * h + 3 * h ^ 2 + 2 * a + 2 * h - 1
        //const formula = '3 * a ^ 2 + 3 * a * h + 3 * a * h + 3 * h ^ 2 + 2 * a + 2 * h - 1'; // should result to 3 * a ^ 2 + 6 * a * h + 3 * h ^ 2 + 2 * a + 2 * h - 1
        //const formula = '3 * a ^ 2 + 3 * a * h + 3 * h * a + 3 * h ^ 2 + 2 * a + 2 * h - 1'; // should result to 3 * a ^ 2 + 6 * a * h + 3 * h ^ 2 + 2 * a + 2 * h - 1
        //const formula = '2 * a * b + 4 * a * b'; // should result to 6 * a * b
        //const formula = '2*b*a + 4*a*b'; // should result to 6 * a * b
        //const formula = `2*a + 3*a`; // should result as 5 * a
        //const formula = `2 * a * b + 3 * a * b`; // should result as 5 * a * b
        //const formula = `2 * a * b + 3 * b * a`; // should result as 5 * a * b

        //console.log('formula', formula);

        let content = `<table border="1">`;

        content += `<tr align="center"><td colspan="5">`
        content += formula;
        content += `</td></tr>`;

        
        content += `<tr>
                        <td>Before Change</td>
                        <td>Change</td>
                        <td>After Change</td>
                        <td>Latex</td>
                        <td># of Substeps</td>
                    </tr>`;

        //debugger;
        const steps = mathsteps.simplifyExpression(formula);

        //console.log(steps);

        content += `<tr align="center"><td colspan="5">`
        content += 'Steps: ' + steps.length;
        content += `</td></tr>`;

        steps.forEach(step => {
            content += `<tr>`;
            content += `<td>` + step.oldNode.toString() + `</td>`;
            content += `<td>` + step.changeType + `</td>`;
            content += `<td>` + mathsteps.printNode.ascii(step.newNode) + `</td>`;
            content += `<td>` + step.newNode.toTex() + `</td>`;
            content += `<td>` + step.substeps.length + `</td>`;
        });

        content += `</table>`;

        example1.innerHTML = content;
    }

    doExample1();

    doUnitTests();

</script>

</html>